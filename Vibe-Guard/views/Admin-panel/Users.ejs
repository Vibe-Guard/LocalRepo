<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Users List</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  
  <style>
    /* Custom Styles */
    .table th, .table td {
      vertical-align: middle;
      padding: 15px;
      text-align: center;
    }
    .btn-custom {
      padding: 10px;
      font-size: 1.2rem;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
      margin-right: 8px;
      border: none;
      cursor: pointer;
    }
    .btn-edit {
      background-color: #0d6efd;
      color: white;
    }
    .btn-edit:hover {
      background-color: #0a58ca;
      transform: scale(1.1);
    }
    .btn-delete {
      background-color: #dc3545;
      color: white;
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
    }
    .btn-delete:hover {
      background-color: #b02a37;
      transform: scale(1.1);
    }
    .btn-suspend {
      background-color: #ffc107;
      color: #212529;
    }
    .btn-unsuspend {
      background-color: #198754;
      color: white;
    }
    .btn-suspend:hover {
      background-color: #e0a800;
      transform: scale(1.1);
    }
    .btn-unsuspend:hover {
      background-color: #146c43;
      transform: scale(1.1);
    }
    .table-responsive {
      margin-top: 30px;
    }
    .table-bordered {
      border: 1px solid #dee2e6;
    }
    .table-hover tbody tr:hover {
      background-color: #f8f9fa;
    }
    .table-dark thead {
      background-color: #28666E;
      color: white;
    }
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <div class="text-center mb-4">
      <h1>Users List</h1>
    </div>

    <!-- Alerts for success or error -->
    <% if (message) { %>
    <div class="alert alert-<%= messageType === 'success' ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
      <%= message %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } %>


    <div class="table-responsive">
      <table class="table table-bordered table-hover table-striped">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Username</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach((user, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= user.username %></td>
            <td><%= user.email %></td>
            <td>
              <div class="d-flex justify-content-center align-items-center gap-2">

                <button
                  class="btn btn-custom <%= user.suspended ? 'btn-unsuspend' : 'btn-suspend' %> suspend-btn"
                  data-user-id="<%= user._id %>"
                  data-username="<%= user.username %>"
                  data-action="<%= user.suspended ? 'unsuspend' : 'suspend' %>"
                  aria-label="<%= user.suspended ? 'Unsuspend User' : 'Suspend User' %>"
                  title="<%= user.suspended ? 'Unsuspend User' : 'Suspend User' %>"
                >
                  <i class="bi <%= user.suspended ? 'bi-check-circle-fill' : 'bi-slash-circle-fill' %>"></i>
                </button>
              </div>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  
    <nav aria-label="Page navigation">
  <ul class="pagination justify-content-center mt-3">

    <% if (currentPage > 1) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= currentPage - 1 %>&limit=<%= limit %>">Previous</a>
      </li>
    <% } else { %>
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
    <% } %>

    <% for(let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= currentPage === i ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
      </li>
    <% } %>

    <% if (currentPage < totalPages) { %>
      <li class="page-item">
        <a class="page-link" href="?page=<%= currentPage + 1 %>&limit=<%= limit %>">Next</a>
      </li>
    <% } else { %>
      <li class="page-item disabled">
        <span class="page-link">Next</span>
      </li>
    <% } %>

  </ul>
</nav>


  <!-- Suspend Confirmation Modal -->
  <div
    class="modal fade"
    id="suspendModal"
    tabindex="-1"
    aria-labelledby="suspendModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <form method="POST" id="suspendForm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="suspendModalLabel">Confirm Action</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            Are you sure you want to <span id="actionType"></span> the user <strong id="modalUsername"></strong>?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="submit" class="btn btn-warning">Yes, Confirm</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.querySelectorAll(".suspend-btn").forEach(button => {
      button.addEventListener("click", () => {
        const userId = button.dataset.userId;
        const username = button.dataset.username;
        const action = button.dataset.action; // suspend or unsuspend, but ignore for form URL

        document.getElementById("modalUsername").textContent = username;
        document.getElementById("actionType").textContent = action;

        // Always post to the toggle suspend URL:
        document.getElementById("suspendForm").action = `/admin/users/${userId}/suspend`;

        const modal = new bootstrap.Modal(document.getElementById("suspendModal"));
        modal.show();
      });
    });
  </script>
</body>
</html>
